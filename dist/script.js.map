{"version":3,"sources":["../script.js"],"names":[],"mappings":"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","file":"script.js","sourcesContent":["const watchers = {};\nconst c1 = document.createElement('canvas');\nconst ctx1 = c1.getContext('2d');\n\nfunction init() {\n  const scale = 0.5;\n\n  const videoFile = document.getElementById(\"uploadInput\").files[0];\n  const leftMoves = files[videoFile.name.replace('.mp4', '')].left;\n  const rightMoves = files[videoFile.name.replace('.mp4', '')].right;\n  const leftPositions = files[videoFile.name.replace('.mp4', '')].leftPosition;\n  const rightPositions = files[videoFile.name.replace('.mp4', '')].rightPosition;\n  for (var i = 0; i < 240; i++) {\n    $('#result tbody').append(`\n      <tr id=\"event-${i}\">\n        <th>#${i+1}, ${leftMoves[i]}</th>\n        <td class=\"leftResult\"></td>\n        <th>#${i+1}, ${rightMoves[i]}</th>\n        <td class=\"rightResult\"></td>\n      </tr>\n    `);\n  }\n  const videoURL = URL.createObjectURL(videoFile);\n  const player = document.getElementById('player');\n\n  player.src = videoURL;\n\n  const c2 = document.getElementById('c2');\n  const ctx2 = c2.getContext('2d');\n\n  const $TL = $('#TL');\n  const $BL = $('#BL');\n  const $BR = $('#BR');\n  const $TR = $('#TR');\n\n  player.addEventListener('canplay', function () {\n    $('#uploadInput').hide();\n    player.currentTime = 0.5; // Triggers seek\n\n    c1.width = player.videoWidth * scale;\n    c1.height = player.videoHeight * scale;\n    c2.width = player.videoWidth * scale;\n    c2.height = player.videoHeight * scale;\n  });\n\n  player.addEventListener('seeked', function () {\n    ctx2.drawImage(player, 0, 0, c2.width, c2.height);\n\n    $('#panel').show();\n  }, false);\n\n  $('#startProcess').click(() => {\n    $('#startProcess').hide();\n    $('#mask').show();\n    player.play();\n    next();\n  });\n\n  function next() {\n    if (player.paused || player.ended) {\n      return;\n    }\n    computeFrame();\n    window.requestAnimationFrame(next);\n  }\n\n  function computeFrame() {\n    ctx1.drawImage(player, 0, 0, c2.width, c2.height);\n    const currentItem = Math.floor((player.currentTime - 100 / 120) * 100 / 120);\n    if (currentItem >= 0) {\n      const frame = ctx1.getImageData(0, 0, c2.width, c2.height);\n      let TLM00 = 0;\n      let TLM10 = 0;\n      let TLM01 = 0;\n\n      let TRM00 = 0;\n      let TRM10 = 0;\n      let TRM01 = 0;\n\n      let BLM00 = 0;\n      let BLM10 = 0;\n      let BLM01 = 0;\n\n      let BRM00 = 0;\n      let BRM10 = 0;\n      let BRM01 = 0;\n      for (var i = 0; i < frame.data.length / 4; i++) {\n        const r = frame.data[i * 4];\n        const g = frame.data[i * 4 + 1];\n        const b = frame.data[i * 4 + 2];\n        const intensity = 0.2989*r + 0.5870*g + 0.1140*b;\n        const x = i % c2.width;\n        const y = Math.floor(i / c2.width);\n\n        if (x < c2.width / 2 && y < c2.height / 2) {\n          TLM00 += intensity;\n          TLM10 += x * intensity;\n          TLM01 += y * intensity;\n        }\n        if (x > c2.width / 2 && y < c2.height / 2) {\n          TRM00 += intensity;\n          TRM10 += x * intensity;\n          TRM01 += y * intensity;\n        }\n        if (x > c2.width / 2 && y > c2.height / 2) {\n          BRM00 += intensity;\n          BRM10 += x * intensity;\n          BRM01 += y * intensity;\n        }\n        if (x < c2.width / 2 && y > c2.height / 2) {\n          BLM00 += intensity;\n          BLM10 += x * intensity;\n          BLM01 += y * intensity;\n        }\n        frame[i * 4] = intensity;\n        frame[i * 4 + 1] = intensity;\n        frame[i * 4 + 2] = intensity;\n        frame[i * 4 + 3] = 255;\n      }\n      ctx2.putImageData(frame, 0, 0, 0, 0, c2.width, c2.height);\n      $TL.attr('cx', TLM10 / TLM00).attr('cy', TLM01 / TLM00);\n      $BL.attr('cx', BLM10 / BLM00).attr('cy', BLM01 / BLM00);\n      $BR.attr('cx', BRM10 / BRM00).attr('cy', BRM01 / BRM00);\n      $TR.attr('cx', TRM10 / TRM00).attr('cy', TRM01 / TRM00);\n    }\n  }\n  player.addEventListener('ended', function () {\n    console.log('end');\n  });\n}\n"]}