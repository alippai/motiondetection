{"version":3,"sources":["../script.js"],"names":[],"mappings":"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","file":"script.js","sourcesContent":["const watchers = {};\n\nfunction init() {\n  \"use strict\";\n  const scale = 0.5;\n\n  const videoFile = document.getElementById(\"uploadInput\").files[0];\n  const leftMoves = files[videoFile.name.replace('.mp4', '')].left;\n  const rightMoves = files[videoFile.name.replace('.mp4', '')].right;\n  const leftPositions = files[videoFile.name.replace('.mp4', '')].leftPosition;\n  const rightPositions = files[videoFile.name.replace('.mp4', '')].rightPosition;\n  for (var i = 0; i < 240; i++) {\n    $('#result tbody').append(`\n      <tr id=\"event-${i}\">\n        <th>#${i+1}, ${leftMoves[i]}</th>\n        <td class=\"leftResult\"></td>\n        <th>#${i+1}, ${rightMoves[i]}</th>\n        <td class=\"rightResult\"></td>\n      </tr>\n    `);\n  }\n  const videoURL = URL.createObjectURL(videoFile);\n  const player = document.getElementById('player');\n  var cropperElem = null;\n  const leftResults = [];\n  const rightResults = [];\n\n  player.src = videoURL;\n\n  const c2 = document.getElementById('c2');\n  const ctx2 = c2.getContext('2d');\n\n  player.addEventListener('canplay', function () {\n    $('#uploadInput').hide();\n    player.currentTime = 0.05; // Triggers seek\n\n    $('#container').width(player.videoWidth * scale);\n\n    c2.width = player.videoWidth * scale;\n    c2.height = player.videoHeight * scale;\n  });\n\n  player.addEventListener('seeked', function () {\n    ctx2.drawImage(player, 0, 0, c2.width, c2.height);\n\n\n    /*addWatcher('LH', {\"left\":97,\"top\":134,\"width\":89,\"height\":34});\n    $('.left-hand .position').text(JSON.stringify({\"left\":97,\"top\":134,\"width\":89,\"height\":34}));\n    addWatcher('CH', {\"left\":205,\"top\":149,\"width\":79,\"height\":46});\n    $('.center-hand .position').text(JSON.stringify({\"left\":205,\"top\":149,\"width\":79,\"height\":46}));\n    addWatcher('RH', {\"left\":310,\"top\":137,\"width\":85,\"height\":30});\n    $('.right-hand .position').text(JSON.stringify({\"left\":310,\"top\":137,\"width\":85,\"height\":30}));\n    addWatcher('LF', {\"left\":169,\"top\":302,\"width\":39,\"height\":158});\n    $('.left-foot .position').text(JSON.stringify({\"left\":169,\"top\":302,\"width\":39,\"height\":158}));\n    addWatcher('CF', {\"left\":183,\"top\":469,\"width\":105,\"height\":30});\n    $('.center-foot .position').text(JSON.stringify({\"left\":183,\"top\":469,\"width\":105,\"height\":30}));\n    addWatcher('RF', {\"left\":294,\"top\":322,\"width\":50,\"height\":146});\n    $('.right-foot .position').text(JSON.stringify({\"left\":294,\"top\":322,\"width\":50,\"height\":146}));*/\n\n    $('.left-hand .position').text(JSON.stringify(leftPositions.LH));\n    addWatcher('LLH', leftPositions.LH);\n    $('.center-hand .position').text(JSON.stringify(leftPositions.CH));\n    addWatcher('LCH', leftPositions.CH);\n    $('.right-hand .position').text(JSON.stringify(leftPositions.RH));\n    addWatcher('LRH', leftPositions.RH);\n    $('.left-foot .position').text(JSON.stringify(leftPositions.LF));\n    addWatcher('LLF', leftPositions.LF);\n    $('.center-foot .position').text(JSON.stringify(leftPositions.CF));\n    addWatcher('LCF', leftPositions.CF);\n    $('.right-foot .position').text(JSON.stringify(leftPositions.RF));\n    addWatcher('LRF', leftPositions.RF);\n\n    addWatcher('RLH', rightPositions.LH);\n    addWatcher('RCH', rightPositions.CH);\n    addWatcher('RRH', rightPositions.RH);\n    addWatcher('RLF', rightPositions.LF);\n    addWatcher('RCF', rightPositions.CF);\n    addWatcher('RRF', rightPositions.RF);\n\n    cropperElem = $('#container > canvas').cropper({\n      guides: false,\n      center: false,\n      background: false,\n      movable: false,\n      rotatable: false,\n      zoomable: false,\n      mouseWheelZoom: false,\n      touchDragZoom: false,\n      doubleClickToggle: false\n    });\n\n    $('#panel').show();\n  }, false);\n/*\n  $('.left-hand button').click(() => {\n    const data = cropperElem.cropper('getCropBoxData'); // {left: 96, top: 54, width: 768, height: 432}\n    cropperElem.cropper('clear');\n    $('.left-hand .position').text(JSON.stringify(data));\n    addWatcher('LH', data);\n    return false;\n  });\n  $('.center-hand button').click(() => {\n    const data = cropperElem.cropper('getCropBoxData'); // {left: 96, top: 54, width: 768, height: 432}\n    cropperElem.cropper('clear');\n    $('.center-hand .position').text(JSON.stringify(data));\n    addWatcher('CH', data);\n    return false;\n  });\n  $('.right-hand button').click(() => {\n    const data = cropperElem.cropper('getCropBoxData'); // {left: 96, top: 54, width: 768, height: 432}\n    cropperElem.cropper('clear');\n    $('.right-hand .position').text(JSON.stringify(data));\n    addWatcher('RH', data);\n    return false;\n  });\n  $('.left-foot button').click(() => {\n    const data = cropperElem.cropper('getCropBoxData'); // {left: 96, top: 54, width: 768, height: 432}\n    cropperElem.cropper('clear');\n    $('.left-foot .position').text(JSON.stringify(data));\n    addWatcher('LF', data);\n    return false;\n  });\n  $('.center-foot button').click(() => {\n    const data = cropperElem.cropper('getCropBoxData'); // {left: 96, top: 54, width: 768, height: 432}\n    cropperElem.cropper('clear');\n    $('.center-foot .position').text(JSON.stringify(data));\n    addWatcher('CF', data);\n    return false;\n  });\n  $('.right-foot button').click(() => {\n    const data = cropperElem.cropper('getCropBoxData'); // {left: 96, top: 54, width: 768, height: 432}\n    cropperElem.cropper('clear');\n    $('.right-foot .position').text(JSON.stringify(data));\n    addWatcher('RF', data);\n    return false;\n  });\n*/\n  $('#startProcess').click(() => {\n    cropperElem.cropper('destroy');\n    $('#startProcess').hide();\n    player.play();\n    next();\n  });\n\n  function addWatcher(which, positions) {\n    var data = JSON.parse(JSON.stringify(positions));\n    const frame = ctx2.getImageData(data.left, data.top, data.width, data.height);\n    data.reference = frame.data;\n\n    watchers[which] = data;\n  }\n\n  function next() {\n    if (player.paused || player.ended) {\n      return;\n    }\n    computeFrame();\n    window.requestAnimationFrame(next);\n  }\n\n  function computeFrame() {\n    ctx2.drawImage(player, 0, 0, c2.width, c2.height);\n    const currentItem = Math.floor(player.currentTime * 100 / 120);\n\n    $('#result tr').removeClass('current');\n    for (let i = 0; i < currentItem; i++) {\n      $('#event-' + i).addClass('completed');\n    }\n    $('#event-' + currentItem).addClass('current');\n\n    const data = watchers['L' + leftMoves[currentItem]];\n    const frame = ctx2.getImageData(data.left, data.top, data.width, data.height);\n    var diff = 0;\n    for (var j = 0; j < frame.data.length; j++) {\n      if (j % 4 !== 3) diff += Math.abs(frame.data[j] - data.reference[j]);\n    }\n    diff = diff / frame.data.length;\n    console.log(diff);\n    if (diff > 3 && !leftResults[currentItem]) {\n      const result = player.currentTime - currentItem * 120/100;\n      leftResults[currentItem] = result;\n      $('#event-' + currentItem + ' .leftResult').text(result.toFixed(5))\n    }\n\n    const data2 = watchers['R' + rightMoves[currentItem]];\n    const frame2 = ctx2.getImageData(data2.left, data2.top, data2.width, data2.height);\n    var diff2 = 0;\n    for (var j = 0; j < frame2.data.length; j++) {\n      if (j % 4 !== 3) diff2 += Math.abs(frame2.data[j] - data2.reference[j]);\n    }\n    diff2 = diff2 / frame2.data.length;\n    console.log(diff2);\n    if (diff2 > 3 && !rightResults[currentItem]) {\n      const result2 = player.currentTime - currentItem * 120/100;\n      rightResults[currentItem] = result2;\n      $('#event-' + currentItem + ' .rightResult').text(result2.toFixed(5))\n    }\n  }\n  player.addEventListener('ended', function () {\n    console.log('end');\n  });\n}\n"]}